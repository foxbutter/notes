# 微信支付

## 服务商：电商收付通

### 开通步骤

> 参考：
>
> 0. 平台收付通功能接入流程了解：https://pay.weixin.qq.com/wiki/doc/apiv3_partner/open/pay/chapter3_3_1.shtml
>1. 微信合作伙伴接入指引（即服务商申请）：https://kf.qq.com/faq/161220iqeAfA1612202yeURB.html
> 2. 电商收付通接入指引：https://kf.qq.com/faq/200316ZfMfMf200316fq2mIN.html
> 2. AppID及其主体信息查询指引：https://kf.qq.com/faq/181105JJNbmm181105eUZfee.html



1. 成为服务商（[服务商平台](https://pay.weixin.qq.com/static/partner_guide/partner_types.shtml)申请）
2. 参数申请与配置：
   1. 注意：开通电商收付通需确保在本平台没有已经入驻或处于入驻流程中的二级商户；So, 开通工具包前不要入驻子商户！
   2. 公众号APPID、服务商收款账号mchid、API KEY、商户证书
3. 开通工具箱（平台收付通工具箱）
4. 收付通产品配置：
   1. 关联AppID
   1. 根据自身使用场景，关联对应的 AppID，开通支付功能（例如，开通App主体的支付功能并关联AppID）
5. 通过接口进件二级商户
6. 开始对接支付、合单支付、补差、分账等功能



### 注意点：

#### 补差

1. 订单支付成功并结算完成后，发起分账前进行补差。
2. 取消补差的前提需要订单发生退款，在调用退款接口后调用取消补差接口

#### 分账

1. 如果分账订单已经分账完结，用户申请退全款应该如何操作？
1. https://pay.weixin.qq.com/wiki/doc/api/allocation.php?chapter=26_4
2. 如果分账接收方类型为个人openid，则已分账到个人的分账金额无法回退，商家需自己补贴相应的分账金额给到用户
3. 如果分账接收方类型为商户号，则已分账到商户号的分账金额可以调用请求分账回退接口进行分账回退
温馨提示：退款和分账回退没有耦合，分账回退可以先于退款请求，也可以后于退款请求
2. 调用”请求分账“接口给多个分账接收方进行分账的情况下，会出现部分成功、部分失败的结果吗”？会的
3. 分账订单的退款与分账回退并无强耦合。分账回退的资金是回到商户可用余额中，分账回退可先于退款发起，亦可后于退款发起，或者，不发起分账回退。在二级商户余额充足的情况下，可以不发起回退，直接发起退款。是否需要分账回退，可由根据分账方与商户的约定决定。
4. 补差金额，如果有发生退款的话，补差金额可以随便填吗？都可以

#### 其他

- https://pay.weixin.qq.com/index.php/public/public_tools/index/toolkit/toolkit_details/3001
- 接口调用顺序限制：1.先补差>后分账；2.先退款>后退补差；3.退分账与否、回退时机无限制



# 支付宝

## 互联网平台直付通

> 参考：
>
> 1. 直付通产品介绍：https://opendocs.alipay.com/pre-open/06og2e

- 开通流程在文档中交代的较清楚，较微信容易些，此处略
